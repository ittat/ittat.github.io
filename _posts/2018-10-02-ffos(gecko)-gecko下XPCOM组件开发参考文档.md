<article>
		<div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post">
								<div class="article-copyright">
					版权声明：本文为博主打劫来的文章！！！未经允许可以随便转载。 May you do good and not evil.  May you share freely, never taking more than you give.					https://blog.csdn.net/hunter___/article/details/80947113				</div>
								            <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-e2445db1a8.css">
						<div class="htmledit_views">
                <div>前面分开写了js 和C++ 的实现，</div><p><a href="https://blog.csdn.net/hunter___/article/details/80912846" rel="nofollow" target="_blank">ffos (gecko):如何在gecko 中编写XPCOM组件（一）－－javascript 实现方式</a></p><p><a href="https://blog.csdn.net/hunter___/article/details/80938305" rel="nofollow" target="_blank">ffos (gecko):如何在gecko 中编写XPCOM组件（二）－－C++ 实现方式</a></p><p><a href="https://blog.csdn.net/hunter___/article/details/80522130" rel="nofollow" target="_blank">xpcom refference links</a> XPCM相关<br></p><div>整理了文档，一起贴上来。</div><div><br><p align="center">gecko<span style="font-family:SimSun;">下</span>XPCOM<span style="font-family:SimSun;">组件</span><span style="font-family:SimSun;">开</span><span style="font-family:SimSun;">发</span><span style="font-family:SimSun;">参考</span><span style="font-family:SimSun;">文档</span> <br></p><p align="justify">&nbsp;</p><table cellspacing="0" border="1"><tbody><tr><td colspan="4" valign="top"><p align="center">版本历史</p></td></tr><tr><td valign="top"><p align="center">版本号</p></td><td valign="top"><p align="center">作者</p></td><td valign="top"><p align="center">日期</p></td><td valign="top"><p align="center">备注</p></td></tr><tr><td valign="top"><p align="center">V1.0</p></td><td valign="top"><p align="center">h<br></p></td><td valign="top"><p align="center">2018.07.06</p></td><td valign="top"><p align="center"><br></p></td></tr></tbody></table><p>&nbsp;</p><h1 align="center"><a name="t0"></a><a name="_Toc910736924" target="_blank"></a><strong><span style="font-family:SimSun;">目录</span></strong></h1><p><a href="#_Toc910736924" rel="nofollow" target="_self"><span style="font-family:SimSun;">目录</span>	</a>1</p><p><a href="#_Toc3154928" rel="nofollow" target="_self"><span style="font-family:SimSun;">摘要</span>	1</a></p><p><a href="#_Toc1400525500" rel="nofollow" target="_self">1. XPCOM<span style="font-family:SimSun;">技术</span>		2</a></p><p><a href="#_Toc1024446785" rel="nofollow" target="_self">1.1 XPCOM<span style="font-family:SimSun;">是什么</span>	2</a></p><p><a href="#_Toc1515316710" rel="nofollow" target="_self">1.2 XPCOM&nbsp;<span style="font-family:SimSun;">架构</span>	2</a></p><p><a href="#_Toc1263809694" rel="nofollow" target="_self">2. XPCOM<span style="font-family:SimSun;">组件</span><span style="font-family:SimSun;">开发</span>	3</a></p><p><a href="#_Toc917276820" rel="nofollow" target="_self">2.1&nbsp;javascript<span style="font-family:SimSun;">实现</span><span style="font-family:SimSun;">方式</span>	5</a></p><p><a href="#_Toc547603303" rel="nofollow" target="_self">2.2 C++<span style="font-family:SimSun;">实现</span><span style="font-family:SimSun;">方式</span>	</a><span style="font-family:SimSun;">６</span></p><p><a name="_Toc3154928" target="_blank"></a><br></p></div><br clear="all"><p align="center"><strong><span style="font-family:SimSun;">摘要</span></strong></p><p>&nbsp;</p><p>XPCOM<span style="font-family:SimSun;">是</span>gecko<span style="font-family:SimSun;">中</span><span style="font-family:SimSun;">很</span><span style="font-family:SimSun;">核心</span><span style="font-family:SimSun;">的</span><span style="font-family:SimSun;">技术</span><span style="font-family:SimSun;">，</span><span style="font-family:SimSun;">本文</span><span style="font-family:SimSun;">尝试</span><span style="font-family:SimSun;">在</span>gecko<span style="font-family:SimSun;">中</span><span style="font-family:SimSun;">添加</span><span style="font-family:SimSun;">两个</span><span style="font-family:SimSun;">简单</span>XPCOM<span style="font-family:SimSun;">组件</span><span style="font-family:SimSun;">，</span><span style="font-family:SimSun;">展示</span>XPCOM<span style="font-family:SimSun;">的</span><span style="font-family:SimSun;">基本</span><span style="font-family:SimSun;">开发</span><span style="font-family:SimSun;">示例</span><span style="font-family:SimSun;">，</span><span style="font-family:SimSun;">为</span><span style="font-family:SimSun;">后</span><span style="font-family:SimSun;">续</span><span style="font-family:SimSun;">工</span><span style="font-family:SimSun;">作</span><span style="font-family:SimSun;">提供</span><span style="font-family:SimSun;">一些</span><span style="font-family:SimSun;">参考</span><span style="font-family:SimSun;">。</span></p><p>&nbsp;</p><h1><a name="t1"></a><strong>1. XPCOM&nbsp;<span style="font-family:SimSun;">技术</span></strong></h1><h2><a name="t2"></a><a name="_Toc1024446785" target="_blank"></a><strong>1.1 XPCOM<span style="font-family:SimHei;">是什么</span></strong></h2><p>XPCOM 的目标是使软件的不同部分分别开发, 相互独立. 为了是应用的不同组件之间能够互操作, XPCOM 把组件的实现与接口(后面讨论接口)分开. 同时 XPCOM 还提供了加载和操纵这些组件的库和工具以及服务, 以帮助开发人员编写跨平台的代码和组件版本管理; 因此组件可以在不破坏应用或者重新生成应用的同时被替换被更新. 通过使用 XPCOM, 开发人员创建的组件可以在不同的应用中被重用, 或者替换当前应用中的组件以改变应用的功能.</p><p>XPCOM 不只提供组件软件开发的支持, 它同时提供一个开发平台的大多数功能的支持:</p><p><span style="font-family:SimSun;">组件管理</span></p><p><span style="font-family:SimSun;">文件抽象</span></p><p><span style="font-family:SimSun;">对象消息传递</span></p><p><span style="font-family:SimSun;">内存管理</span></p><p><span style="font-family:SimSun;">可以</span><span style="font-family:SimSun;">把</span> XPCOM 想象成一个 组件开发平台, 它提供了上面的这些特性<span style="font-family:SimSun;">。</span></p><p>Gecko&nbsp;<span style="font-family:SimSun;">中</span><span style="font-family:SimSun;">应用</span><span style="font-family:SimSun;">地</span><span style="font-family:SimSun;">很</span><span style="font-family:SimSun;">核心</span><span style="font-family:SimSun;">技术</span><span style="font-family:SimSun;">，</span><span style="font-family:SimSun;">相当</span><span style="font-family:SimSun;">与</span>microsoft&nbsp;<span style="font-family:SimSun;">的</span>COM<span style="font-family:SimSun;">技术</span><span style="font-family:SimSun;">（</span><span style="font-family:SimSun;">又是</span><span style="font-family:SimSun;">借鉴</span><span style="font-family:SimSun;">）</span><span style="font-family:SimSun;">，</span><span style="font-family:SimSun;">用</span><span style="font-family:SimSun;">的</span><span style="font-family:SimSun;">很</span><span style="font-family:SimSun;">广，</span><span style="font-family:SimSun;">按</span><span style="font-family:SimSun;">我</span><span style="font-family:SimSun;">的</span><span style="font-family:SimSun;">理解，</span><span style="font-family:SimSun;">用</span><span style="font-family:SimSun;">于</span><span style="font-family:SimSun;">扩展</span>gecko&nbsp;<span style="font-family:SimSun;">本身</span><span style="font-family:SimSun;">，</span><span style="font-family:SimSun;">用</span>js<span style="font-family:SimSun;">或</span><span style="font-family:SimSun;">实现</span><span style="font-family:SimSun;">的</span><span style="font-family:SimSun;">往</span><span style="font-family:SimSun;">上</span><span style="font-family:SimSun;">可</span><span style="font-family:SimSun;">提供</span>webidl<span style="font-family:SimSun;">接口的</span><span style="font-family:SimSun;">实现</span><span style="font-family:SimSun;">文件</span><span style="font-family:SimSun;">来</span><span style="font-family:SimSun;">调用</span>,<span style="font-family:SimSun;">往</span><span style="font-family:SimSun;">下</span><span style="font-family:SimSun;">则</span><span style="font-family:SimSun;">可以</span><span style="font-family:SimSun;">对</span><span style="font-family:SimSun;">更</span><span style="font-family:SimSun;">下层</span><span style="font-family:SimSun;">的</span><span style="font-family:SimSun;">进行</span><span style="font-family:SimSun;">封装</span><span style="font-family:SimSun;">。</span></p><p>&nbsp;</p><h2><a name="t3"></a><a name="_Toc1515316710" target="_blank"></a><strong>1.2 XPCOM<span style="font-family:SimHei;">架构</span></strong></h2><p>Gecko&nbsp;<span style="font-family:SimSun;">与</span>XPCOM<span style="font-family:SimSun;">的</span><span style="font-family:SimSun;">关系</span><span style="font-family:SimSun;">可以</span><span style="font-family:SimSun;">简单</span><span style="font-family:SimSun;">粗暴</span><span style="font-family:SimSun;">理解</span><span style="font-family:SimSun;">成</span><span style="font-family:SimSun;">，</span>gecko=<span style="font-family:SimSun;">一</span><span style="font-family:SimSun;">堆</span>XPCOM<span style="font-family:SimSun;">组件</span><span style="font-family:SimSun;">。</span></p><h1><a name="t4"></a><a name="_Toc1263809694" target="_blank"></a><strong>2. XPCOM <span style="font-family:SimSun;">组件</span><span style="font-family:SimSun;">开发</span></strong></h1><p><span style="font-family:SimSun;">下</span><span style="font-family:SimSun;">面</span><span style="font-family:SimSun;">介绍</span>gecko<span style="font-family:SimSun;">下</span>XPCOM&nbsp;<span style="font-family:SimSun;">组件</span><span style="font-family:SimSun;">的</span><span style="font-family:SimSun;">写法</span><span style="font-family:SimSun;">框架</span>&nbsp;<span style="font-family:SimSun;">。</span></p><h2><a name="t5"></a><strong>2.1&nbsp;javascript<span style="font-family:SimHei;">实现</span><span style="font-family:SimHei;">方式</span></strong></h2><p>&nbsp;</p><p><span style="font-family:SimSun;">涉及到的目录及文件及其作用原理：</span></p><h3><a name="t6"></a><strong>2.1.1&nbsp;js<span style="font-family:SimSun;">组件编写</span></strong></h3><p>&nbsp;</p><p><span style="font-family:SimSun;">１．</span>js <span style="font-family:SimSun;">组件最终目录结构：</span></p><p>gecko/dom/simplejs/</p><p>&nbsp;</p><table cellspacing="0" border="1"><tbody><tr><td valign="top"><p><span>simplejs</span></p><p><span>├── <span style="font-family:Calibri;">moz.build</span></span></p><p><span>├── <span style="font-family:Calibri;">nsISimplejs.idl</span></span></p><p><span>├── <span style="font-family:Calibri;">nsIUseComponent.idl</span></span></p><p><span>├── <span style="font-family:Calibri;">Simplejs.js</span></span></p><p><span>├── <span style="font-family:Calibri;">Simplejs.manifest</span></span></p><p><span>├── <span style="font-family:Calibri;">UseComponent.js</span></span></p><p><span>└── <span style="font-family:Calibri;">UseComponent.manifest</span></span></p><p>&nbsp;</p></td></tr></tbody></table><p>&nbsp;</p><p><span style="font-family:SimSun;">２．组件实现：</span></p><p><span style="font-family:SimSun;">（１）</span>nsISimplejs.idl<span style="font-family:SimSun;">　接口定义文件</span></p><table cellspacing="0" border="1"><tbody><tr><td valign="top"><p>&nbsp;</p><p><span style="color:#385623;">#include "nsISupports.idl"</span></p><p><span style="color:#385623;">[scriptable, uuid(ce32e3ff-36f8-425f-94be-d85b26e634ee)]</span></p><p><span style="color:#385623;">interface nsISimpleComponent : nsISupports</span></p><p><span style="color:#385623;">{</span></p><p><span style="color:#385623;">&nbsp;&nbsp;&nbsp;&nbsp;attribute string yourName;</span></p><p><span style="color:#385623;">&nbsp;&nbsp;&nbsp;&nbsp;void write();</span></p><p><span style="color:#385623;">&nbsp;&nbsp;&nbsp;&nbsp;void changejs(in string aValue);</span></p><p><span style="color:#385623;">};</span></p><p>&nbsp;</p></td></tr></tbody></table><p>&nbsp;</p><p><span style="font-family:SimSun;">（２）</span>Simplejs.js<span style="font-family:Calibri;">nsISimplejs.idl</span><span style="font-family:SimSun;">的实现文件</span></p><table cellspacing="0" border="1"><tbody><tr><td valign="top"><p><span style="color:#385623;">&nbsp;</span></p><p><span style="color:#385623;">"use strict";</span></p><p><span style="color:#385623;">&nbsp;</span></p><p><span style="color:#385623;">const Cc = Components.classes;</span></p><p><span style="color:#385623;">const Ci = Components.interfaces;</span></p><p><span style="color:#385623;">const Cu = Components.utils;</span></p><p><span style="color:#385623;">const Cr = Components.results;</span></p><p><span style="color:#385623;">&nbsp;</span></p><p><span style="color:#385623;">Cu.import("resource://gre/modules/XPCOMUtils.jsm");</span></p><p><span style="color:#385623;">Cu.import("resource://gre/modules/Services.jsm");</span></p><p><span style="color:#385623;">&nbsp;</span></p><p><span style="color:#385623;">function SimpleComponentImpl() {</span></p><p><span style="color:#385623;">&nbsp;&nbsp;&nbsp;&nbsp;debug("yahaha,constructor SimpleComponentImpl constructor in simplecomponent.js################");</span></p><p><span style="color:#385623;">}</span></p><p><span style="color:#385623;">&nbsp;</span></p><p><span style="color:#385623;">//dump("yahaha,dump,im SimpleComponentImpl in simplecomponent.js######################### before prototype");</span></p><p><span style="color:#385623;">&nbsp;</span></p><p><span style="color:#385623;">SimpleComponentImpl.prototype = {</span></p><p><span style="color:#385623;">&nbsp;</span></p><p><span style="color:#385623;">&nbsp;&nbsp;&nbsp;&nbsp;contractID : "@mozilla.org/simplejs;1",</span></p><p><span style="color:#385623;">&nbsp;&nbsp;&nbsp;&nbsp;classID: Components.ID("{cc587afa-0696-469f-9eff-9dac0dd727fe}"),</span></p><p><span style="color:#385623;">&nbsp;&nbsp;&nbsp;&nbsp;QueryInterface: XPCOMUtils.generateQI([Ci.nsISimpleComponent]),</span></p><p><span style="color:#385623;">&nbsp;</span></p><p><span style="color:#385623;">&nbsp;&nbsp;&nbsp;&nbsp;get yourName(){ </span></p><p><span style="color:#385623;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return this.mName; </span></p><p><span style="color:#385623;">&nbsp;&nbsp;&nbsp;&nbsp;},</span></p><p><span style="color:#385623;">&nbsp;&nbsp;&nbsp;&nbsp;set yourName(aName){ </span></p><p><span style="color:#385623;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return this.mName = aName;</span></p><p><span style="color:#385623;">&nbsp;&nbsp;&nbsp;&nbsp;},</span></p><p><span style="color:#385623;">&nbsp;&nbsp;&nbsp;&nbsp;write: function(){ </span></p><p><span style="color:#385623;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dump("yahaha,SimpleComponentImpl.write()");</span></p><p><span style="color:#385623;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dump("Hello " + this.mName + "\n");</span></p><p><span style="color:#385623;">&nbsp;&nbsp;&nbsp;&nbsp;},</span></p><p><span style="color:#385623;">&nbsp;&nbsp;&nbsp;&nbsp;changejs: function(aValue){ </span></p><p><span style="color:#385623;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.mName = aValue;</span></p><p><span style="color:#385623;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dump("Hello " + this.mName + "\n");</span></p><p><span style="color:#385623;">&nbsp;</span></p><p><span style="color:#385623;">&nbsp;&nbsp;&nbsp;&nbsp;},</span></p><p><span style="color:#385623;">&nbsp;&nbsp;&nbsp;&nbsp;mName: "Anonymous!",</span></p><p><span style="color:#385623;">};//the implement of interfaces in .idl</span></p><p><span style="color:#385623;">&nbsp;</span></p><p><span style="color:#385623;">//dump("yahaha,dump,in simplecomponent.js###############before generateNSGetFactory");</span></p><p><span style="color:#385623;">this.NSGetFactory = XPCOMUtils.generateNSGetFactory([SimpleComponentImpl]);//get factory</span></p><p><span style="color:#385623;">//dump("yahaha SimpleComponent.js ooooooooooooooooooooooooooooooooooooooooo");</span></p><p>&nbsp;</p></td></tr></tbody></table><p>&nbsp;</p><p><span style="font-family:SimSun;">（３）</span>Simplejs.manifest<span style="font-family:SimSun;">　组件注册清单文件</span></p><table cellspacing="0" border="1"><tbody><tr><td valign="top"><p><span style="color:#385623;"># Simplejs.</span><span style="color:#385623;">manifest</span></p><p><span style="color:#385623;">component {cc587afa-0696-469f-9eff-9dac0dd727fe} Simplejs.js</span></p><p><span style="color:#385623;">contract @mozilla.org/simplejs;1 {cc587afa-0696-469f-9eff-9dac0dd727fe}</span></p><p><span style="color:#385623;">category profile-after-change simplecomponent @mozilla.org/simplejs;1</span></p></td></tr></tbody></table><p>&nbsp;</p><p>(4)<span style="font-family:SimSun;">在</span><span style="font-family:Calibri;">gecko/b2g/installer/package-manifest.in</span></p><p>dom_simplejs.xpt<span style="font-family:SimSun;">是</span><span style="font-family:Calibri;">moz.build </span><span style="font-family:SimSun;">指定生成的</span><span style="font-family:Calibri;">xpt</span><span style="font-family:SimSun;">模块。见</span><span style="font-family:Calibri;">moz.build</span><span style="font-family:SimSun;">部分。</span></p><p><span style="font-family:SimSun;">添加：</span></p><table cellspacing="0" border="1"><tbody><tr><td valign="top"><p><span style="color:#385623;">@RESPATH@/components/dom_simplejs.xpt</span></p><p><span style="color:#385623;">@RESPATH@/components/Simplejs.js</span></p><p><span style="color:#385623;">@RESPATH@/components/Simplejs.manifest</span></p></td></tr></tbody></table><p><span style="font-family:SimSun;">（５）</span>moz.build</p><p><span style="font-family:SimSun;">编译文件。写法如下：</span></p><table cellspacing="0" border="1"><tbody><tr><td valign="top"><p>&nbsp;</p><p><span style="color:#385623;"># vim: set filetype=python:</span></p><p><span style="color:#385623;">XPIDL_MODULE = 'dom_simplejs'</span></p><p><span style="color:#385623;">&nbsp;</span></p><p><span style="color:#385623;">XPIDL_SOURCES += [</span></p><p><span style="color:#385623;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'nsISimplejs.idl',</span></p><p><span style="color:#385623;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;]</span></p><p><span style="color:#385623;">EXTRA_COMPONENTS += [</span></p><p><span style="color:#385623;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'Simplejs.js',</span></p><p><span style="color:#385623;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'Simplejs.manifest',</span></p><p><span style="color:#385623;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;]</span></p><p><span style="color:#385623;">&nbsp;</span></p><p><span style="color:#385623;">include('/ipc/chromium/chromium-config.mozbuild')</span></p><p><span style="color:#385623;">ALLOW_COMPILER_WARNINGS=True</span></p><p><span style="color:#385623;">&nbsp;</span></p><p><span style="color:#385623;">FINAL_LIBRARY = 'xul'</span></p><p><span style="color:#385623;">&nbsp;</span></p><p><span style="color:#385623;">if CONFIG['GNU_CXX']:</span></p><p><span style="color:#385623;">&nbsp;&nbsp;&nbsp;&nbsp;CXXFLAGS += ['-Wshadow']</span></p><p>&nbsp;</p></td></tr></tbody></table><p>&nbsp;<span style="font-family:SimSun;">（６）在</span>gecko/dom/ <span style="font-family:SimSun;">目录下在</span><span style="font-family:Calibri;">moz.build</span><span style="font-family:SimSun;">中将</span><span style="font-family:Calibri;">simplejs</span><span style="font-family:SimSun;">文件夹添加进去</span></p><table cellspacing="0" border="1"><tbody><tr><td valign="top"><p><span style="color:#385623;">DIRS += [</span></p><p><span style="color:#385623;">... <span style="font-family:SimSun;">这里省略很多目录</span><span style="font-family:Calibri;">...</span></span></p><p><span style="color:#385623;">'simplejs',</span></p><p><span style="color:#385623;">]</span></p></td></tr></tbody></table><p><span style="font-family:SimSun;">开始编译，通过，刷机。</span></p><p><span style="font-family:SimSun;">以上，</span>js <span style="font-family:SimSun;">实现的组件的实现及注册添加完成。</span></p><p>&nbsp;</p><h3><a name="t7"></a><strong>2.1.2&nbsp;js<span style="font-family:SimSun;">组件</span><span style="font-family:SimSun;">调用</span></strong></h3><p>&nbsp;</p><p><span style="font-family:SimSun;">理论上，可以在</span>gecko <span style="font-family:SimSun;">源码中任何组件中调用注册好的</span><span style="font-family:Calibri;">js </span><span style="font-family:SimSun;">组件。这里我自己再写一个组件来调用刚刚写好的组件就好。</span></p><p><span style="font-family:SimSun;">流程跟上面的完全一样。仍然在</span>gecko/dom/simplejs/<span style="font-family:SimSun;">目录下</span></p><p>（１）nsIUseComponent.idl<span style="font-family:SimSun;">　其实可有可无，目的是调用我们写了的组件，具体的接口我没去实现。</span></p><table cellspacing="0" border="1"><tbody><tr><td valign="top"><p>&nbsp;</p><p><span style="color:#385623;">#include "nsISupports.idl"</span></p><p><span style="color:#385623;">[scriptable, uuid(6632e3ff-36f8-425f-94be-d85b26e634ee)]</span></p><p><span style="color:#385623;">interface nsIUseComponent : nsISupports</span></p><p><span style="color:#385623;">{</span></p><p><span style="color:#385623;">&nbsp;&nbsp;&nbsp;&nbsp;void sayhi();</span></p><p><span style="color:#385623;">};</span></p></td></tr></tbody></table><p><span style="font-family:SimSun;">（２）</span>UseComponent.js </p><p><span style="font-family:SimSun;">接口实现文件，其实这里我没去实现，醉翁之意不在酒，主要为了调用写成功了的组件。</span></p><table cellspacing="0" border="1"><tbody><tr><td valign="top"><p>&nbsp;</p><p><span style="color:#385623;">"use strict";</span></p><p><span style="color:#385623;">const Cc = Components.classes;</span></p><p><span style="color:#385623;">const Ci = Components.interfaces;</span></p><p><span style="color:#385623;">const Cu = Components.utils;</span></p><p><span style="color:#385623;">const Cr = Components.results;</span></p><p><span style="color:#385623;">&nbsp;</span></p><p><span style="color:#385623;">Cu.import("resource://gre/modules/XPCOMUtils.jsm");</span></p><p><span style="color:#385623;">Cu.import("resource://gre/modules/Services.jsm");</span></p><p><span style="color:#385623;">&nbsp;</span></p><p><span style="color:#385623;">const USECOMPONENT_CONTRACTID = "@mozilla.org/usecomponent;1";</span></p><p><span style="color:#385623;">const USECOMPONENT_CID =</span></p><p><span style="color:#385623;">&nbsp;&nbsp;Components.ID("{1ff24790-5e74-11e1-b86c-0800200c9a66}");</span></p><p><span style="color:#385623;">//////////////////////////////////////////////////////////////</span></p><p><span style="color:#385623;">&nbsp;</span></p><p><span style="color:#385623;">//test of javascript component</span></p><p><span style="color:#385623;">///////////////////////////////////////////////////////////</span></p><p><span style="color:#385623;">dump("yahaha,========&gt;start: javascript component==================&gt;"); </span></p><p><span style="color:#385623;">var usecompo =Cc["@mozilla.org/simplejs;1"].createInstance(Components.interfaces.nsISimpleComponent);</span></p><p><span style="color:#385623;">var result = usecompo.yourName;//the interface name in .idl </span></p><p><span style="color:#385623;">dump("yahaha,...result: yourName = "+result);</span></p><p><span style="color:#385623;">usecompo.changejs("yahaha,change after yourName");//call changejs() interface</span></p><p><span style="color:#385623;">dump("yahaha,========&gt;end: javascript component====================&gt;\n ");</span></p><p><span style="color:#385623;">&nbsp;</span></p><p><span style="color:#385623;">///Test of other exist<span style="font-family:Calibri;">cpp component </span></span></p><p><span style="color:#385623;">//////////////////////////////////////////////////////////// </span></p><p><span style="color:#385623;">dump("yahaha,==========&gt;start test1....instance of other cpp component in usecomponent.js ");</span></p><p><span style="color:#385623;">var nfcservi =Cc["@mozilla.org/nfc/service;1"].createInstance(Components.interfaces.nsINfcService);</span></p><p><span style="color:#385623;">dump("yahaha,nfc,,,,,,"+nfcservi);</span></p><p><span style="color:#385623;">dump("yahaha,=========&gt;end test1 ===================================&gt;\n ");</span></p><p><span style="color:#385623;">///////////////////////////////////////////////////////////////////</span></p><p><span style="color:#385623;">&nbsp;</span></p><p><span style="color:#385623;">//the implement part of this component itself</span></p><p><span style="color:#385623;">function useComponentImpl(){</span></p><p><span style="color:#385623;">&nbsp;&nbsp;&nbsp;&nbsp;dump("yahaha,this is a null component in useComponentImpl");</span></p><p><span style="color:#385623;">}</span></p><p><span style="color:#385623;">useComponentImpl.prototype={</span></p><p><span style="color:#385623;">&nbsp;&nbsp;&nbsp;&nbsp;//const USECOMPONENT_CONTRACTID = "@mozilla.org/usecomponent;1";</span></p><p><span style="color:#385623;">&nbsp;&nbsp;&nbsp;&nbsp;//const USECOMPONENT_CID =Components.ID("{1ff24790-5e74-11e1-b86c-0800200c9a66}");</span></p><p><span style="color:#385623;">&nbsp;&nbsp;&nbsp;&nbsp;contractID : USECOMPONENT_CONTRACTID, </span></p><p><span style="color:#385623;">&nbsp;&nbsp;&nbsp;&nbsp;classID: USECOMPONENT_CID,</span></p><p><span style="color:#385623;">&nbsp;&nbsp;&nbsp;&nbsp;QueryInterface: XPCOMUtils.generateQI([Ci.nsIUseComponent]),</span></p><p><span style="color:#385623;">&nbsp;&nbsp;&nbsp;&nbsp;duuuump:function(){ dump("yahaha, hello world???");</span></p><p><span style="color:#385623;">&nbsp;&nbsp;&nbsp;&nbsp;},</span></p><p><span style="color:#385623;">}</span></p><p><span style="color:#385623;">this.NSGetFactory = XPCOMUtils.generateNSGetFactory([useComponentImpl]);//part of register code</span></p><p>&nbsp;</p></td></tr></tbody></table><p><span style="font-family:SimSun;">（３）</span>UseComponent.manifest</p><p><span style="font-family:SimSun;">注册清单文件。</span></p><table cellspacing="0" border="1"><tbody><tr><td valign="top"><p><span style="color:#385623;">component {1ff24790-5e74-11e1-b86c-0800200c9a66} UseComponent.js</span></p><p><span style="color:#385623;">contract @mozilla.org/usecomponent;1 {1ff24790-5e74-11e1-b86c-0800200c9a66}</span></p><p><span style="color:#385623;">category profile-after-change usecomponent @mozilla.org/usecomponent;1</span></p></td></tr></tbody></table><p>&nbsp;</p><p>(4)<span style="font-family:SimSun;">在</span><span style="font-family:Calibri;">gecko/b2g/installer/package-manifest.in</span></p><p><span style="font-family:SimSun;">添加：</span></p><table cellspacing="0" border="1"><tbody><tr><td valign="top"><p><span style="color:#385623;">@RESPATH@/components/dom_simplejs.xpt</span></p><p><span style="color:#385623;">@RESPATH@/components/UseComponent.js</span></p><p><span style="color:#385623;">@RESPATH@/components/UseComponent.manifest</span></p></td></tr></tbody></table><p>&nbsp;</p><p><span style="font-family:SimSun;">而两个组件所添加的合起来如下：</span></p><table cellspacing="0" border="1"><tbody><tr><td valign="top"><p><span style="color:#385623;">@RESPATH@/components/dom_simplecpp.xpt</span></p><p><span style="color:#385623;">@RESPATH@/components/dom_simplejs.xpt</span></p><p><span style="color:#385623;">@RESPATH@/components/Simplejs.js</span></p><p><span style="color:#385623;">@RESPATH@/components/Simplejs.manifest</span></p><p><span style="color:#385623;">@RESPATH@/components/UseComponent.js</span></p><p><span style="color:#385623;">@RESPATH@/components/UseComponent.manifest</span></p></td></tr></tbody></table><p>&nbsp;</p><p><span style="font-family:SimSun;">（５）</span>moz.build</p><p>&nbsp;</p><p><span style="font-family:SimSun;">编译文件。两个组件的编译文件如下：</span></p><table cellspacing="0" border="1"><tbody><tr><td valign="top"><p>&nbsp;</p><p><span style="color:#385623;"># vim: set filetype=python:</span></p><p><span style="color:#385623;">&nbsp;</span></p><p><span style="color:#385623;">XPIDL_MODULE = 'dom_simplejs'</span></p><p><span style="color:#385623;">&nbsp;</span></p><p><span style="color:#385623;">XPIDL_SOURCES += [</span></p><p><span style="color:#385623;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'nsISimplejs.idl',</span></p><p><span style="color:#385623;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'nsIUsecomponent.idl',</span></p><p><span style="color:#385623;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;]</span></p><p><span style="color:#385623;">EXTRA_COMPONENTS += [</span></p><p><span style="color:#385623;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'Simplejs.js',</span></p><p><span style="color:#385623;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'Simplejs.manifest',</span></p><p><span style="color:#385623;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'UseComponent.js',</span></p><p><span style="color:#385623;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'UseComponent.manifest',</span></p><p><span style="color:#385623;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;]</span></p><p><span style="color:#385623;">&nbsp;</span></p><p><span style="color:#385623;">include('/ipc/chromium/chromium-config.mozbuild')</span></p><p><span style="color:#385623;">ALLOW_COMPILER_WARNINGS=True</span></p><p><span style="color:#385623;">&nbsp;</span></p><p><span style="color:#385623;">FINAL_LIBRARY = 'xul'</span></p><p><span style="color:#385623;">&nbsp;</span></p><p><span style="color:#385623;">if CONFIG['GNU_CXX']:</span></p><p><span style="color:#385623;">&nbsp;&nbsp;&nbsp;&nbsp;CXXFLAGS += ['-Wshadow']</span></p></td></tr></tbody></table><p>&nbsp;</p><p><span style="font-family:SimSun;">编译通过，刷机，</span>adb logcat <span style="font-family:SimSun;">看</span><span style="font-family:Calibri;">log.</span></p><p><span style="font-family:SimSun;">最后的</span>adb logcat<span style="font-family:SimSun;">结果</span><span style="font-family:Calibri;">:</span></p><p>adb logcat|grep -in yahaha</p><p>&nbsp;</p><table cellspacing="0" border="1"><tbody><tr><td valign="top"><p><span>&nbsp;</span></p><p><span>363:I/Gecko &nbsp;&nbsp;( &nbsp;180): yahaha,========&gt;start: javascript component==================&gt;</span></p><p><span>364:I/Gecko &nbsp;&nbsp;( &nbsp;180): yahaha,...result: yourName = Anonymous!</span></p><p><span>365:I/Gecko &nbsp;&nbsp;( &nbsp;180): Hello yahaha,change after yourName</span></p><p><span>366:I/Gecko &nbsp;&nbsp;( &nbsp;180): yahaha,========&gt;end: javascript component====================&gt;</span></p><p><span>368:I/Gecko &nbsp;&nbsp;( &nbsp;180): yahaha,==========&gt;start test1....instance of other cpp component in usecomponent.js </span></p><p><span>369:I/Gecko &nbsp;&nbsp;( &nbsp;180): yahaha,nfc,,,,,,[xpconnect wrapped nsINfcService]</span></p><p><span>370:I/Gecko &nbsp;&nbsp;( &nbsp;180): yahaha,=========&gt;end test1 ===================================&gt;</span></p><p>&nbsp;</p></td></tr></tbody></table><h2><a name="t8"></a><strong>2.2&nbsp;C++ <span style="font-family:SimHei;">实现</span><span style="font-family:SimHei;">方式</span></strong></h2><h3><a name="t9"></a><strong>2.2.1 C++&nbsp;<span style="font-family:SimSun;">组件</span><span style="font-family:SimSun;">编写</span></strong></h3><p>&nbsp;</p><p><span style="font-family:SimSun;">在</span>gecko/dom/<span style="font-family:SimSun;">下</span><span style="font-family:SimSun;">新</span><span style="font-family:SimSun;">建</span><span style="font-family:SimSun;">一个</span><span style="font-family:SimSun;">文件</span><span style="font-family:SimSun;">夹</span><span style="font-family:SimSun;">，</span>simplecpp,<span style="font-family:SimSun;">将</span>simplecpp<span style="font-family:SimSun;">添加</span><span style="font-family:SimSun;">到</span>gecko/dom/moz.build<span style="font-family:SimSun;">下</span><span style="font-family:SimSun;">。</span></p><table cellspacing="0" border="1"><tbody><tr><td valign="top"><p><span style="color:#385623;">DIRS += [</span></p><p><span style="color:#385623;">... <span style="font-family:SimSun;">这里省略很多目录</span><span style="font-family:Calibri;">...</span></span></p><p><span style="color:#385623;">'simple</span><span style="color:#385623;">cpp</span><span style="color:#385623;">',</span></p><p><span style="color:#385623;">]</span></p></td></tr></tbody></table><p>&nbsp;</p><p><span style="font-family:SimSun;">最后整个目录结构如下：</span></p><table cellspacing="0" border="1"><tbody><tr><td valign="top"><p><span style="color:#375623;">simplecpp/</span></p><p><span style="color:#375623;">├── <span style="font-family:Calibri;">moz.build</span></span></p><p><span style="color:#375623;">├── <span style="font-family:Calibri;">nsISimplecpp.idl</span></span></p><p><span style="color:#375623;">├── <span style="font-family:Calibri;">Simplecpp.cpp</span></span></p><p><span style="color:#375623;">└── <span style="font-family:Calibri;">Simplecpp.h</span></span></p><p>&nbsp;</p></td></tr></tbody></table><p>&nbsp;</p><p>（１）nsISimplecpp.idl<span style="font-family:SimSun;">接口</span><span style="font-family:SimSun;">定义</span></p><table cellspacing="0" border="1"><tbody><tr><td valign="top"><p><span style="color:#375623;">nsISimplecpp.idl </span></p><p><span style="color:#375623;">#include "nsISupports.idl"</span></p><p><span style="color:#375623;">[scriptable, uuid(fd306b58-02de-4dc7-a512-f1ade5cf6840)]</span></p><p><span style="color:#375623;">interface </span><span>nsISimplecpp</span><span style="color:#375623;">&nbsp;: nsISupports</span></p><p><span style="color:#375623;">{</span></p><p><span style="color:#375623;">&nbsp;&nbsp;&nbsp;&nbsp;attribute string yourName;</span></p><p><span style="color:#375623;">&nbsp;&nbsp;&nbsp;&nbsp;void write( );</span></p><p><span style="color:#375623;">&nbsp;&nbsp;&nbsp;&nbsp;void change(in string aValue);</span></p><p><span style="color:#375623;">&nbsp;&nbsp;&nbsp;&nbsp;void usecomponent(in string aValue1);</span></p><p><span style="color:#375623;">};</span></p><p>&nbsp;</p></td></tr></tbody></table><p>（２）Simple.h</p><p>nsISimplecpp.h<span style="font-family:SimSun;">是</span>nsISimplecpp.idl <span style="font-family:SimSun;">生成的</span><span style="font-family:SimSun;">头</span><span style="font-family:SimSun;">文件</span><span style="font-family:SimSun;">，</span><span style="font-family:SimSun;">它</span><span style="font-family:SimSun;">在</span>objdir-gecko/dist/include/<span style="font-family:SimSun;">下</span><span style="font-family:SimSun;">。</span><span style="font-family:SimSun;">文件</span><span style="font-family:SimSun;">里面</span><span style="font-family:SimSun;">包含了</span><span style="font-family:SimSun;">组件</span><span style="font-family:SimSun;">实现</span><span style="font-family:SimSun;">文件</span><span style="font-family:SimSun;">的</span><span style="font-family:SimSun;">头文件</span><span style="font-family:SimSun;">模板</span><span style="font-family:SimSun;">和</span>cpp<span style="font-family:SimSun;">文件</span><span style="font-family:SimSun;">模板。</span><span style="font-family:SimSun;">将</span>/*Header&nbsp;file*/<span style="font-family:SimSun;">开始</span><span style="font-family:SimSun;">的</span><span style="font-family:SimSun;">代码</span><span style="font-family:SimSun;">复制</span><span style="font-family:SimSun;">到</span><span style="font-family:SimSun;">实现</span><span style="font-family:SimSun;">文件</span><span style="font-family:SimSun;">的</span><span style="font-family:SimSun;">头文件</span><span style="font-family:SimSun;">中</span><span style="font-family:SimSun;">，</span></p><table cellspacing="0" border="1"><tbody><tr><td valign="top"><p>/* Use the code below as a template for the implementation class for this interface. */</p><p>&nbsp;</p><p><span>/* Header file */</span><span>&nbsp;</span><span>从</span><span>这里</span><span>开始</span></p><p><span>class nsSimplecpp : public nsISimplecpp</span></p><p><span>{</span></p><p><span>public:</span></p><p><span>&nbsp;&nbsp;NS_DECL_ISUPPORTS</span></p><p><span>&nbsp;&nbsp;NS_DECL_NSISIMPLECPP</span></p><p><span>&nbsp;</span></p><p><span>&nbsp;&nbsp;nsSimplecpp();</span></p><p><span>&nbsp;</span></p><p><span>private:</span></p><p><span>&nbsp;&nbsp;~nsSimplecpp();</span></p><p><span>&nbsp;</span></p><p><span>protected:</span></p><p><span>&nbsp;&nbsp;/* additional members */</span></p><p><span>};</span></p><p>&nbsp;</p></td></tr></tbody></table><p><span style="font-family:SimSun;">完整</span><span style="font-family:SimSun;">头文件</span><span style="font-family:SimSun;">如下：</span></p><p>&nbsp;</p><table cellspacing="0" border="1"><tbody><tr><td valign="top"><p><span style="color:#375623;">#ifndef mozilla_dom_simplecpp_simplecpp_h</span></p><p><span style="color:#375623;">#define mozilla_dom_simplecpp_simplecpp_h</span></p><p><span style="color:#375623;">&nbsp;</span></p><p><span style="color:#375623;">#include "nsCOMPtr.h"</span></p><p><span>#include "nsISimplecpp.h"</span></p><p><span style="color:#375623;">&nbsp;</span></p><p><span style="color:#375623;">namespace mozilla {</span></p><p><span style="color:#375623;">class nsSimplecpp final: public nsISimplecpp</span><span>//</span><span>从<span style="font-family:Calibri;">nsISimplecpp </span><span style="font-family:SimSun;">接口类中继承一个类</span></span></p><p><span style="color:#375623;">{</span></p><p><span style="color:#375623;">public:</span></p><p><span style="color:#375623;">&nbsp;&nbsp;NS_DECL_ISUPPORTS</span></p><p><span style="color:#375623;">&nbsp;&nbsp;NS_DECL_NSISIMPLECPP</span></p><p><span style="color:#375623;">&nbsp;&nbsp;//static already_AddRefed&lt;nsSimplecpp&gt; FactoryCreate();</span></p><p><span style="color:#375623;">&nbsp;&nbsp;nsSimplecpp();</span></p><p><span style="color:#375623;">private:</span></p><p><span style="color:#375623;">&nbsp;&nbsp;virtual &nbsp;~nsSimplecpp();</span></p><p><span style="color:#375623;">protected:</span></p><p><span style="color:#375623;">&nbsp;&nbsp;/* additional members */</span></p><p><span style="color:#375623;">};</span><span style="color:#375623;">/</span><span>/</span><span>扩展</span><span>时</span><span>按需要</span><span>添加</span><span>函数</span><span>进行</span><span>扩展</span></p><p><span style="color:#375623;">}//naemspace mozilla</span></p><p><span style="color:#375623;">&nbsp;</span></p><p><span style="color:#375623;">#endif</span></p><p>&nbsp;</p></td></tr></tbody></table><p>&nbsp;(3)&nbsp;Simple.cpp<span style="font-family:SimSun;">将</span></p><p>/* Implementation file */<span style="font-family:SimSun;">开始</span><span style="font-family:SimSun;">到</span>/* End of implementation class template. */<span style="font-family:SimSun;">之间的</span><span style="font-family:SimSun;">代码</span><span style="font-family:SimSun;">复制</span><span style="font-family:SimSun;">到</span><span style="font-family:SimSun;">你</span><span style="font-family:SimSun;">的</span><span style="font-family:SimSun;">实现</span><span style="font-family:SimSun;">文件</span>Simple.cpp<span style="font-family:SimSun;">里</span><span style="font-family:SimSun;">去</span>.</p><table cellspacing="0" border="1"><tbody><tr><td valign="top"><p>&nbsp;</p><p><span>/* Implementation file */</span></p><p><span style="color:#375623;">NS_IMPL_ISUPPORTS(nsSimplecpp, nsISimplecpp)</span></p><p><span style="color:#375623;">&nbsp;</span></p><p><span style="color:#375623;">nsSimplecpp::nsSimplecpp()</span></p><p><span style="color:#375623;">{</span></p><p><span style="color:#375623;">&nbsp;&nbsp;/* member initializers and constructor code */</span></p><p><span style="color:#375623;">}</span></p><p><span style="color:#375623;">&nbsp;</span></p><p><span style="color:#375623;">nsSimplecpp::~nsSimplecpp()</span></p><p><span style="color:#375623;">{</span></p><p><span style="color:#375623;">&nbsp;&nbsp;/* destructor code */</span></p><p><span style="color:#375623;">}</span></p><p><span style="color:#375623;">&nbsp;</span></p><p><span style="color:#375623;">/* attribute string yourName; */</span></p><p><span style="color:#375623;">NS_IMETHODIMP nsSimplecpp::GetYourName(char * *aYourName)</span></p><p><span style="color:#375623;">{</span></p><p><span style="color:#375623;">&nbsp;&nbsp;&nbsp;&nbsp;return NS_ERROR_NOT_IMPLEMENTED;</span></p><p><span style="color:#375623;">}</span></p><p><span style="color:#375623;">NS_IMETHODIMP nsSimplecpp::SetYourName(const char * aYourName)</span></p><p><span style="color:#375623;">{</span></p><p><span style="color:#375623;">&nbsp;&nbsp;&nbsp;&nbsp;return NS_ERROR_NOT_IMPLEMENTED;</span></p><p><span style="color:#375623;">}</span></p><p><span style="color:#375623;">&nbsp;</span></p><p><span style="color:#375623;">/* void write (); */</span></p><p><span style="color:#375623;">NS_IMETHODIMP nsSimplecpp::Write()</span></p><p><span style="color:#375623;">{</span></p><p><span style="color:#375623;">&nbsp;&nbsp;&nbsp;&nbsp;return NS_ERROR_NOT_IMPLEMENTED;</span></p><p><span style="color:#375623;">}</span></p><p><span style="color:#375623;">&nbsp;</span></p><p><span style="color:#375623;">/* void change (in string aValue); */</span></p><p><span style="color:#375623;">NS_IMETHODIMP nsSimplecpp::Change(const char * aValue)</span></p><p><span style="color:#375623;">{</span></p><p><span style="color:#375623;">&nbsp;&nbsp;&nbsp;&nbsp;return NS_ERROR_NOT_IMPLEMENTED;</span></p><p><span style="color:#375623;">}</span></p><p><span style="color:#375623;">&nbsp;</span></p><p><span style="color:#375623;">/* void usecomponent (in string aValue1); */</span></p><p><span style="color:#375623;">NS_IMETHODIMP nsSimplecpp::Usecomponent(const char * aValue1)</span></p><p><span style="color:#375623;">{</span></p><p><span style="color:#375623;">&nbsp;&nbsp;&nbsp;&nbsp;return NS_ERROR_NOT_IMPLEMENTED;</span></p><p><span style="color:#375623;">}</span></p><p>&nbsp;</p><p><span>/* End of implementation class template. */</span></p><p>&nbsp;</p></td></tr></tbody></table><p>&nbsp;</p><p><span style="font-family:SimSun;">具体的</span><span style="font-family:SimSun;">实现</span><span style="font-family:SimSun;">文件</span><span style="font-family:SimSun;">如下</span><span style="font-family:SimSun;">：</span></p><table cellspacing="0" border="1"><tbody><tr><td valign="top"><p><span style="color:#375623;">#include "Simplecpp.h"</span></p><p><span style="color:#375623;">#include "utils/Log.h"</span></p><p><span style="color:#375623;">#include "nsISimplejs.h"//test of call js component in cpp,failed</span></p><p><span style="color:#375623;">#include &lt;cutils/properties.h&gt;</span></p><p><span style="color:#375623;">#include "mozilla/dom/ToJSValue.h"</span></p><p><span style="color:#375623;">#include "mozilla/ModuleUtils.h"</span></p><p><span style="color:#375623;">#include "nsAutoPtr.h"</span></p><p><span style="color:#375623;">&nbsp;</span></p><p><span style="color:#375623;">#define NS_SIMPLECPP_CID \</span></p><p><span style="color:#375623;">{0x668abcee, 0x29cc, 0x43e9, \</span></p><p><span style="color:#375623;">&nbsp;&nbsp;&nbsp;&nbsp;{ 0x8a, 0x97, 0x9d, 0x3c, 0x0b, 0x67, 0xae, 0x8b }}</span></p><p><span style="color:#375623;">#define NS_SIMPLECPP_CONTRACTID "@mozilla.org/simplecpp;1"</span></p><p><span style="color:#375623;">&nbsp;</span></p><p><span style="color:#375623;">using namespace mozilla::dom;</span></p><p><span style="color:#375623;">namespace mozilla {</span></p><p><span style="color:#375623;">&nbsp;</span></p><p><span style="color:#375623;">/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////</span></p><p><span style="color:#375623;">/* Implementation file */</span></p><p><span style="color:#375623;">NS_IMPL_ISUPPORTS(nsSimplecpp, nsISimplecpp)</span></p><p><span style="color:#375623;">&nbsp;</span></p><p><span style="color:#375623;">nsSimplecpp::nsSimplecpp()</span></p><p><span style="color:#375623;">{ &nbsp;&nbsp;</span></p><p><span style="color:#375623;">&nbsp;&nbsp;&nbsp;&nbsp;MOZ_ASSERT(NS_IsMainThread());</span></p><p><span style="color:#375623;">&nbsp;&nbsp;&nbsp;&nbsp;//MOZ_ASSERT(!gnsSimplecpp);</span></p><p><span style="color:#375623;">&nbsp;&nbsp;&nbsp;&nbsp;ALOGI("yohoho,yahahacpp,log from gecko dom simplecpp.cpp component,nsSimplecpp()");</span></p><p><span style="color:#375623;">&nbsp;&nbsp;/* member initializers and constructor code */</span></p><p><span style="color:#375623;">}</span></p><p><span style="color:#375623;">&nbsp;</span></p><p><span style="color:#375623;">nsSimplecpp::~nsSimplecpp()</span></p><p><span style="color:#375623;">{</span></p><p><span style="color:#375623;">&nbsp;&nbsp;/* destructor code */</span></p><p><span style="color:#375623;">}</span></p><p><span style="color:#375623;">&nbsp;</span></p><p><span style="color:#375623;">/* attribute string yourName; */</span></p><p><span style="color:#375623;">NS_IMETHODIMP nsSimplecpp::GetYourName(char * *aYourName)</span></p><p><span style="color:#375623;">{</span></p><p><span style="color:#375623;">&nbsp;&nbsp;&nbsp;&nbsp;ALOGI("yohoho,yahahacpp,log from gecko dom simplecpp component,GetYourName()");</span></p><p><span style="color:#375623;">&nbsp;&nbsp;&nbsp;&nbsp;//return "MarkTwin";</span></p><p><span style="color:#375623;">&nbsp;&nbsp;&nbsp;&nbsp;return NS_OK;</span></p><p><span style="color:#375623;">}</span></p><p><span style="color:#375623;">&nbsp;</span></p><p><span style="color:#375623;">NS_IMETHODIMP nsSimplecpp::SetYourName(const char * aYourName)</span></p><p><span style="color:#375623;">{</span></p><p><span style="color:#375623;">&nbsp;&nbsp;&nbsp;&nbsp;ALOGI("yohoho,yahahacpp,log from gecko dom simplecpp component,SetYourName()");</span></p><p><span style="color:#375623;">&nbsp;&nbsp;&nbsp;&nbsp;return NS_OK;</span></p><p><span style="color:#375623;">}</span></p><p><span style="color:#375623;">&nbsp;</span></p><p><span style="color:#375623;">/* void write (); */</span></p><p><span style="color:#375623;">NS_IMETHODIMP nsSimplecpp::Write()</span></p><p><span style="color:#375623;">{</span></p><p><span style="color:#375623;">&nbsp;&nbsp;&nbsp;&nbsp;ALOGI("yohoho,yahahacpp,log from gecko dom simplecpp.cpp component,Write()");</span></p><p><span style="color:#375623;">&nbsp;&nbsp;&nbsp;&nbsp;return NS_OK;</span></p><p><span style="color:#375623;">}</span></p><p><span style="color:#375623;">&nbsp;</span></p><p><span style="color:#375623;">/* void change (in string aValue); */</span></p><p><span style="color:#375623;">NS_IMETHODIMP nsSimplecpp::Change(const char * aValue)</span></p><p><span style="color:#375623;">{</span></p><p><span style="color:#375623;">&nbsp;&nbsp;&nbsp;&nbsp;ALOGI("yohoho,yahahacpp,log from gecko dom simplecpp.cpp,Change()");</span></p><p><span style="color:#375623;">&nbsp;&nbsp;&nbsp;&nbsp;nsCOMPtr&lt;nsISimpleComponent&gt; SimpleService=</span></p><p><span style="color:#375623;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;do_CreateInstance("@mozilla.org/simplejs;1");</span></p><p><span style="color:#375623;">&nbsp;&nbsp;&nbsp;&nbsp;if (!SimpleService) {</span></p><p><span style="color:#375623;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ALOGI("yahaha,no Component available");</span></p><p><span style="color:#375623;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></p><p><span style="color:#375623;">&nbsp;&nbsp;&nbsp;&nbsp;SimpleService-&gt;Changejs("anonymous====&gt;");// in .h unfinished</span></p><p><span style="color:#375623;">&nbsp;&nbsp;&nbsp;&nbsp;ALOGI("yahaha,log from simplecpp.cpp after Changechange()");</span></p><p><span style="color:#375623;">&nbsp;&nbsp;&nbsp;&nbsp;return NS_OK;</span></p><p><span style="color:#375623;">}</span></p><p><span style="color:#375623;">&nbsp;</span></p><p><span style="color:#375623;">&nbsp;</span></p><p><span style="color:#375623;">//use the js component, cannot use this function with unknown reason &nbsp;</span></p><p><span style="color:#375623;">/* void usecomponent (in string aValue1); */</span></p><p><span style="color:#375623;">NS_IMETHODIMP nsSimplecpp::Usecomponent(const char * aValue1)</span></p><p><span style="color:#375623;">{</span></p><p><span style="color:#375623;">&nbsp;&nbsp;&nbsp;&nbsp;ALOGI("yohoho,yahahacpp,log from simplecpp.cpp component,Usecomponent()");</span></p><p><span style="color:#375623;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nsCOMPtr&lt;nsISimpleComponent&gt; SimpleService=</span></p><p><span style="color:#375623;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;do_CreateInstance("@mozilla.org/simplejs;1");</span></p><p><span style="color:#375623;">&nbsp;&nbsp;&nbsp;&nbsp;if (!SimpleService) {</span></p><p><span style="color:#375623;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ALOGI("yahaha,no Component available");</span></p><p><span style="color:#375623;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></p><p><span style="color:#375623;">&nbsp;&nbsp;&nbsp;&nbsp;//SimpleService-&gt;yourName;</span></p><p><span style="color:#375623;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color:#375623;">//</span><span style="color:#375623;">SimpleService-&gt;</span><span style="color:#375623;">c</span><span style="color:#375623;">hangejs("anonymous====&gt;");//if cannot use idl interface ,what make u to use js component &nbsp;</span></p><p><span style="color:#375623;">&nbsp;&nbsp;&nbsp;&nbsp;ALOGI("yahaha,log from simplecpp.cpp Usecomponent()");</span></p><p><span style="color:#375623;">&nbsp;&nbsp;&nbsp;&nbsp;return NS_OK;</span></p><p><span style="color:#375623;">}</span></p><p><span style="color:#375623;">/* End of implementation class template. */</span></p><p><span style="color:#375623;">&nbsp;</span></p><p><span style="color:#375623;">//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////</span></p><p><span style="color:#375623;">&nbsp; <br></span></p><p><span style="color:#375623;">///////</span><span style="color:#385623;">///////////////////////////////////////////////////////</span><span style="color:#385623;">///////////////////////////////////////////////////////</span></p><p><span style="color:#375623;">//register the component</span></p><p><span>//<span style="font-family:SimSun;">以下是组件注册部分，十分重要，不进行注册，你的组件写的就是些废代码，编译不报错也没用，其他组件不能调用。这一部分也可以跟其他组件合一起集中注册，按此结构即可。</span></span></p><p><span style="color:#375623;">/*</span></p><p><span style="color:#375623;">&nbsp;*NS_GENERIC_FACTORY_SINGLETON_CONSTRUCTOR(nsSimplecpp,</span></p><p><span style="color:#375623;">&nbsp;* &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nsSimplecpp::FactoryCreate)</span></p><p><span style="color:#375623;">//</span><span style="color:#375623;">也</span><span style="color:#375623;">可</span><span style="color:#375623;">选</span><span style="color:#385623;">SINGLETON</span><span style="color:#385623;">模式</span><span style="color:#385623;">，</span><span style="color:#385623;">但</span><span style="color:#385623;">要</span><span style="color:#385623;">多</span><span style="color:#385623;">写</span><span style="color:#385623;">一个</span><span style="color:#385623;">Fa</span><span style="color:#385623;">ct</span><span style="color:#385623;">oy</span><span style="color:#385623;">C</span><span style="color:#385623;">rea</span><span style="color:#385623;">te</span><span style="color:#385623;">()</span></p><p><span style="color:#375623;">&nbsp;&nbsp;*/</span></p><p><span style="color:#375623;">&nbsp;</span></p><p><span style="color:#375623;">NS_GENERIC_FACTORY_CONSTRUCTOR(nsSimplecpp)</span><span>//</span><span>构造</span><span>你</span><span>的</span><span>类</span></p><p><span style="color:#375623;">&nbsp;</span></p><p><span style="color:#375623;">NS_DEFINE_NAMED_CID(NS_SIMPLECPP_CID);</span><span>/</span><span>/</span><span>定义你</span><span>的</span><span>CI</span><span>D</span></p><p><span style="color:#375623;">&nbsp;</span></p><p><span style="color:#375623;">static const mozilla::Module::CIDEntry knsSimplecppCIDs[] = {</span></p><p><span style="color:#375623;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ &amp;kNS_SIMPLECPP_CID, false, nullptr, nsSimplecppConstructor },</span></p><p><span style="color:#375623;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ nullptr }</span></p><p><span style="color:#375623;">&nbsp;&nbsp;&nbsp;&nbsp;};</span></p><p><span style="color:#375623;">&nbsp;</span></p><p><span style="color:#375623;">static const mozilla::Module::ContractIDEntry knsSimplecppContracts[] = {</span></p><p><span style="color:#375623;">&nbsp;&nbsp;&nbsp;&nbsp;{ NS_SIMPLECPP_CONTRACTID, &amp;kNS_SIMPLECPP_CID },</span></p><p><span style="color:#375623;">&nbsp;&nbsp;&nbsp;&nbsp;{ nullptr }</span></p><p><span style="color:#375623;">};</span></p><p><span style="color:#375623;">&nbsp;</span></p><p><span style="color:#375623;">static const mozilla::Module knsSimplecppModule = {</span><span>//</span><span>你的</span><span>组件</span><span>模块</span><span>信息</span></p><p><span style="color:#375623;">&nbsp;&nbsp;&nbsp;&nbsp;mozilla::Module::kVersion,</span></p><p><span style="color:#375623;">&nbsp;&nbsp;&nbsp;&nbsp;knsSimplecppCIDs,</span></p><p><span style="color:#375623;">&nbsp;&nbsp;&nbsp;&nbsp;knsSimplecppContracts,</span></p><p><span style="color:#375623;">&nbsp;&nbsp;&nbsp;&nbsp;nullptr</span></p><p><span style="color:#375623;">};</span></p><p><span style="color:#375623;">&nbsp;</span></p><p><span style="color:#375623;">}// namespace mozilla</span></p><p><span>&nbsp;</span></p><p><span>NSMODULE_DEFN(nsSimplecppModule) = &amp;mozilla::knsSimplecppModule;</span><span>//</span><span>注册</span><span>你的</span><span>组件</span></p></td></tr></tbody></table><p>(4)moz.build</p><p><span style="font-family:SimSun;">按</span><span style="font-family:SimSun;">以下</span><span style="font-family:SimSun;">格式</span><span style="font-family:SimSun;">来</span><span style="font-family:SimSun;">放</span><span style="font-family:SimSun;">文件</span><span style="font-family:SimSun;">，</span><span style="font-family:SimSun;">编译</span><span style="font-family:SimSun;">即</span><span style="font-family:SimSun;">可</span><span style="font-family:SimSun;">。</span></p><table cellspacing="0" border="1"><tbody><tr><td valign="top"><p><span style="color:#375623;"># -*- Mode: python; c-basic-offset: 4; indent-tabs-mode: nil; tab-width: 40 -*-</span></p><p><span style="color:#375623;"># vim: set filetype=python:</span></p><p><span>#</span><span>idl</span><span>接口</span><span>文件</span><span>放</span><span>这里</span></p><p><span style="color:#375623;">XPIDL_SOURCES += [</span></p><p><span style="color:#375623;">&nbsp;&nbsp;&nbsp;&nbsp;'nsISimplecpp.idl',</span></p><p><span style="color:#375623;">]</span></p><p><span>＃</span><span>给你</span><span>的</span><span>组件</span><span>模块</span><span>取</span><span>个</span><span>名</span><span>，</span><span>会</span><span>生成</span><span>相应的</span><span>.</span><span>xpt</span><span>,</span><span>如</span><span>这里</span><span>的</span><span>生成</span><span>do</span><span>m</span><span>_</span><span>sim</span><span>ple</span><span>c</span><span>pp</span><span>.xp</span><span>t</span></p><p><span>#</span><span>在</span><span>objdir-gecko/dist/bin/components/dom_simplecpp.xpt </span></p><p><span style="color:#375623;">XPIDL_MODULE = 'dom_simplecpp'</span></p><p><span style="color:#375623;">&nbsp;</span></p><p><span style="color:#375623;">EXPORTS.mozilla.dom.simplecpp += [</span></p><p><span style="color:#375623;">&nbsp;&nbsp;&nbsp;&nbsp;'Simplecpp.h',</span></p><p><span style="color:#375623;">]</span></p><p><span style="color:#375623;">&nbsp;</span></p><p><span style="color:#375623;">UNIFIED_SOURCES += [</span></p><p><span style="color:#375623;">&nbsp;&nbsp;&nbsp;&nbsp;'Simplecpp.cpp',</span></p><p><span style="color:#375623;">]</span></p><p><span style="color:#375623;">&nbsp;</span></p><p><span style="color:#375623;">include('/ipc/chromium/chromium-config.mozbuild')</span></p><p><span>#</span><span>放</span><span>在</span><span>哪个</span><span>库</span><span>里</span></p><p><span style="color:#375623;">FINAL_LIBRARY = 'xul'</span></p><p><span style="color:#375623;">&nbsp;</span></p><p><span style="color:#375623;">if CONFIG['GNU_CXX']:</span></p><p><span style="color:#375623;">&nbsp;&nbsp;&nbsp;&nbsp;CXXFLAGS += ['-Wshadow']</span></p><p>&nbsp;</p></td></tr></tbody></table><p><span style="font-family:SimSun;">至</span><span style="font-family:SimSun;">此，</span>C++<span style="font-family:SimSun;">组件</span><span style="font-family:SimSun;">编写</span><span style="font-family:SimSun;">完成。</span></p><p>&nbsp; <br></p><h3><a name="t10"></a><strong>2.2.<span style="font-family:SimSun;">２</span>C++&nbsp;<span style="font-family:SimSun;">组件</span><span style="font-family:SimSun;">调用</span></strong></h3><p>C++<span style="font-family:SimSun;">的</span><span style="font-family:SimSun;">组件</span><span style="font-family:SimSun;">注册</span><span style="font-family:SimSun;">完成</span><span style="font-family:SimSun;">之后</span><span style="font-family:SimSun;">同样</span><span style="font-family:SimSun;">用</span><span style="font-family:SimSun;">前面的</span>js<span style="font-family:SimSun;">组件</span><span style="font-family:SimSun;">来</span><span style="font-family:SimSun;">调用</span><span style="font-family:SimSun;">。</span></p><p><span style="font-family:SimSun;">基于</span><span style="font-family:SimSun;">上个</span><span style="font-family:SimSun;">组件</span><span style="font-family:SimSun;">，</span><span style="font-family:SimSun;">修改</span>gecko/dom/simplejs/UseComponent.js&nbsp;<span style="font-family:SimSun;">添加</span>C++<span style="font-family:SimSun;">组件</span><span style="font-family:SimSun;">测试</span><span style="font-family:SimSun;">部分</span><span style="font-family:SimSun;">。</span></p><table cellspacing="0" border="1"><tbody><tr><td valign="top"><p><span style="color:#375623;">"use strict";</span></p><p><span style="color:#375623;">const Cc = Components.classes;</span></p><p><span style="color:#375623;">const Ci = Components.interfaces;</span></p><p><span style="color:#375623;">const Cu = Components.utils;</span></p><p><span style="color:#375623;">const Cr = Components.results;</span></p><p><span style="color:#375623;">&nbsp;</span></p><p><span style="color:#375623;">Cu.import("resource://gre/modules/XPCOMUtils.jsm");</span></p><p><span style="color:#375623;">Cu.import("resource://gre/modules/Services.jsm");</span></p><p><span style="color:#375623;">&nbsp;</span></p><p><span style="color:#375623;">const USECOMPONENT_CONTRACTID = "@mozilla.org/usecomponent;1";</span></p><p><span style="color:#375623;">const USECOMPONENT_CID =</span></p><p><span style="color:#375623;">&nbsp;&nbsp;Components.ID("{1ff24790-5e74-11e1-b86c-0800200c9a66}");</span></p><p><span style="color:#375623;">//////////////////////////////////////////////////////////////</span></p><p><span style="color:#375623;">&nbsp;</span></p><p><span style="color:#375623;">&nbsp;</span></p><p><span style="color:#375623;">//test of javascript component</span></p><p><span style="color:#375623;">///////////////////////////////////////////////////////////</span></p><p><span style="color:#375623;">dump("yahaha,========&gt;start: javascript component==================&gt;"); </span></p><p><span style="color:#375623;">var usecompo =Cc["@mozilla.org/simplejs;1"].createInstance(Components.interfaces.nsISimpleComponent);</span><span>//</span><span>创建</span><span>@mozilla.org/simplejs</span><span>组件</span><span>的</span><span>实例</span><span>，</span><span>之后</span><span>通过</span><span>Components.interfaces.nsISimpleComponent</span><span>找到</span><span>你</span><span>定义的</span><span>接口</span><span>，</span><span>然后</span><span>再</span><span>调</span><span>用你</span><span>定义</span><span>在</span><span>接口</span><span>下</span><span>的</span><span>接口</span><span>函数</span></p><p><span style="color:#375623;">var result = usecompo.yourName;//the interface name in .idl </span></p><p><span style="color:#375623;">dump("yahaha,...result: yourName = "+result);</span></p><p><span style="color:#375623;">usecompo.changejs("yahaha,change after yourName");</span></p><p><span style="color:#375623;">dump("yahaha,========&gt;end: javascript component====================&gt;\n ");</span></p><p><span style="color:#375623;">&nbsp;</span></p><p><span style="color:#375623;">&nbsp;</span></p><p><span style="color:#375623;">&nbsp;</span></p><p><span style="color:#375623;">///</span><span style="color:#375623;">t</span><span style="color:#375623;">est of other exist component </span></p><p><span style="color:#375623;">//////////////////////////////////////////////////////////// </span></p><p><span style="color:#375623;">dump("yahaha,==========&gt;start test1....instance of other cpp component in usecomponent.js ");</span></p><p><span style="color:#375623;">var nfcservi =Cc["@mozilla.org/nfc/service;1"].createInstance(Components.interfaces.nsINfcService);</span></p><p><span style="color:#375623;">dump("yahaha,nfc,,,,,,"+nfcservi);</span></p><p><span style="color:#375623;">dump("yahaha,=========&gt;end test1 ===================================&gt;\n ");</span></p><p><span style="color:#375623;">&nbsp;</span></p><p><span style="color:#375623;">&nbsp;</span></p><p><span style="color:#375623;">&nbsp;</span></p><p><span>//</span><span>t</span><span>est</span><span>&nbsp;of</span><span>&nbsp;c++ component</span></p><p><span>//////////////////////////////////////////////////////////////// </span></p><p><span>dump("yahahacpp,==========&gt;start,test of cpp component==================&gt;");</span></p><p><span>var Simplecpp =Cc["@mozilla.org/simplecpp;1"].createInstance(Components.interfaces.nsISimplecpp);</span></p><p><span>&nbsp;</span></p><p><span>dump("yahahacpp,before change()");</span></p><p><span>var result_simplecpp = Simplecpp.change("daye");</span></p><p><span>dump("yahahacpp,============&gt;end of cpp component test====================&gt;\n ");</span></p><p><span>&nbsp;</span></p><p><span>var atest = Simplecpp.usecomponent("Atest");</span></p><p><span>dump("yahahacpp,after Simplecpp.usecomponent() result of usecomponent:"+atest);</span></p><p><span style="color:#375623;">///////////////////////////////////////////////////////////////////</span></p><p><span style="color:#375623;">//</span><span style="color:#375623;">以下</span><span style="color:#375623;">代码有</span><span style="color:#375623;">疑问</span><span style="color:#375623;">参看</span><span style="color:#375623;">js</span><span style="color:#375623;">&nbsp;</span><span style="color:#375623;">组件</span><span style="color:#375623;">实现</span><span style="color:#375623;">部分</span></p><p><span style="color:#375623;">function useComponentImpl(){</span></p><p><span style="color:#375623;">&nbsp;&nbsp;&nbsp;&nbsp;dump("yahaha,this is a null component in useComponentImpl");</span></p><p><span style="color:#375623;">}</span></p><p><span style="color:#375623;">useComponentImpl.prototype={</span></p><p><span style="color:#375623;">&nbsp;&nbsp;&nbsp;&nbsp;//const USECOMPONENT_CONTRACTID = "@mozilla.org/usecomponent;1";</span></p><p><span style="color:#375623;">&nbsp;&nbsp;&nbsp;&nbsp;//const USECOMPONENT_CID =</span></p><p><span style="color:#375623;">&nbsp;&nbsp;&nbsp;&nbsp;//Components.ID("{1ff24790-5e74-11e1-b86c-0800200c9a66}");</span></p><p><span style="color:#375623;">&nbsp;&nbsp;&nbsp;&nbsp;contractID : USECOMPONENT_CONTRACTID, </span></p><p><span style="color:#375623;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;classID: USECOMPONENT_CID,</span></p><p><span style="color:#375623;">&nbsp;&nbsp;&nbsp;&nbsp;QueryInterface: XPCOMUtils.generateQI([Ci.nsIUseComponent]),</span></p><p><span style="color:#375623;">&nbsp;</span></p><p><span style="color:#375623;">&nbsp;&nbsp;&nbsp;&nbsp;duuuump:function(){ dump("yahaha, hello world???");</span></p><p><span style="color:#375623;">&nbsp;&nbsp;&nbsp;&nbsp;},</span></p><p><span style="color:#375623;">}</span></p><p><span style="color:#375623;">&nbsp;</span></p><p><span style="color:#375623;">this.NSGetFactory = XPCOMUtils.generateNSGetFactory([useComponentImpl]);</span></p><p>&nbsp;</p></td></tr></tbody></table><p><span style="font-family:SimSun;">编译</span><span style="font-family:SimSun;">，</span><span style="font-family:SimSun;">刷机</span><span style="font-family:SimSun;">，</span><span style="font-family:SimSun;">测试</span><span style="font-family:SimSun;">。</span><span style="font-family:SimSun;">相应</span><span style="font-family:SimSun;">的</span><span style="font-family:SimSun;">组件</span><span style="font-family:SimSun;">都</span><span style="font-family:SimSun;">正常</span><span style="font-family:SimSun;">调用</span><span style="font-family:SimSun;">。</span><span style="font-family:SimSun;">最后</span><span style="font-family:SimSun;">的</span>log<span style="font-family:SimSun;">如下</span><span style="font-family:SimSun;">：</span></p><table cellspacing="0" border="1"><tbody><tr><td valign="top"><p><span>357:I/Gecko &nbsp;&nbsp;( &nbsp;180): yahaha,========&gt;start: javascript component==================&gt;</span></p><p><span>358:I/Gecko &nbsp;&nbsp;( &nbsp;180): yahaha,...result: yourName = Anonymous!</span></p><p><span>359:I/Gecko &nbsp;&nbsp;( &nbsp;180): Hello yahaha,change after yourName</span></p><p><span>360:I/Gecko &nbsp;&nbsp;( &nbsp;180): yahaha,========&gt;end: javascript component====================&gt;</span></p><p><span>362:I/Gecko &nbsp;&nbsp;( &nbsp;180): yahaha,==========&gt;start test1....instance of other cpp component in usecomponent.js </span></p><p><span>363:I/Gecko &nbsp;&nbsp;( &nbsp;180): yahaha,nfc,,,,,,[xpconnect wrapped nsINfcService]</span></p><p><span>364:I/Gecko &nbsp;&nbsp;( &nbsp;180): yahaha,=========&gt;end test1 ===================================&gt;</span></p><p><span>366:I/Gecko &nbsp;&nbsp;( &nbsp;180): yahahacpp,==========&gt;start,test of cpp component==================&gt;</span></p><p><span>367:I/ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;( &nbsp;180): yohoho,yahahacpp,log from gecko dom simplecpp.cpp component,nsSimplecpp()</span></p><p><span>368:I/Gecko &nbsp;&nbsp;( &nbsp;180): yahahacpp,before change()</span></p><p><span>369:I/ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;( &nbsp;180): yohoho,yahahacpp,log from gecko dom simplecpp.cpp,Change()</span></p><p><span>371:I/ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;( &nbsp;180): yahaha,log from simplecpp.cpp after Changechange()</span></p><p><span>372:I/Gecko &nbsp;&nbsp;( &nbsp;180): yahahacpp,============&gt;end of cpp component test====================&gt;</span></p><p><span>374:I/ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;( &nbsp;180): yohoho,yahahacpp,log from simplecpp.cpp component,Usecomponent()</span></p><p><span>376:I/ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;( &nbsp;180): yahaha,log from simplecpp.cpp Usecomponent()</span></p><p><span>377:I/Gecko &nbsp;&nbsp;( &nbsp;180): yahahacpp,after Simplecpp.usecomponent() result of usecomponent:undefined</span></p><p><span>378:I/Gecko &nbsp;&nbsp;( &nbsp;180): yahaha,this is a null component in useComponentImpl</span></p></td></tr></tbody></table>            </div>
                </div>
									
					<script>
						(function(){
							function setArticleH(btnReadmore,posi){
								var winH = $(window).height();
								var articleBox = $("div.article_content");
								var artH = articleBox.height();
								if(artH > winH*posi){
									articleBox.css({
										'height':winH*posi+'px',
										'overflow':'hidden'
									})
									btnReadmore.click(function(){
										articleBox.removeAttr("style");
										$(this).parent().remove();
									})
								}else{
									btnReadmore.parent().remove();
								}
							}
							var btnReadmore = $("#btn-readmore");
							if(btnReadmore.length>0){
								if(currentUserName){
									setArticleH(btnReadmore,3);
								}else{
									setArticleH(btnReadmore,1.2);
								}
							}
						})()
					</script>
					</article>
